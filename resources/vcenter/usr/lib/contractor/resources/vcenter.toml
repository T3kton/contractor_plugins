sflinks = [ [ 'linux-base', 'vcenter-vm-base' ] ]

[ foundation.vcenter-vm-base ]
  description = 'Base VCenter VM'
  scripts = { 'create' = 'vcenter-vm-create', 'destroy' = 'vcenter-vm-destroy' }
  foundation_types = [ 'VCenter' ]
  config_values = { '>packages' = ' open-vm-tools', 'memory_size' = 1024, 'cpu_count' = 1 }
  template = {}
  physical_interface_names = []

[ script.vcenter-vm-create ]
  description = 'Create VCenter VM'
  script = """# Create VCenter VM
vm_spec = foundation.vcenter_vmspec

begin( description='Locate Host' )
  host_list = vcenter.host_list( min_memory=vm_spec.memory_size )
end

begin( description='Locate Datastore' )
  datastore_list = vcenter.datastore_list( host=host_list[0], min_free_space=5 )
end

begin( description='VM Creation' )
  vm_uuid = vcenter.create( host=host_list[0], datastore=datastore_list[0], vm_spec=vm_spec )
  foundation.vcenter_uuid = vm_uuid
  interface_map = foundation.get_interface_map()
  foundation.set_interface_macs( interface_map=interface_map )
end
"""

[ script.vcenter-vm-destroy ]
  description = 'Destroy Generi VCenter VM'
  script = """# Destory VCenter VM
begin( description='VM Destruction' )
  foundation.power_off()
  foundation.destroy()
  foundation.vcenter_uuid = None
end
"""
